
水陆大会2代码说明

sldh2已经基本完成，这是我第一个有点规模的作品，希望各位前辈多指正。
感谢normal以前的支持，感谢xiand现在的鼓励，感谢shines的辛苦参与。

                                             firefox 12/12/09

●sldh2安装

为了避免外部对sldh2内部的影响，也同时避免sldh2影响外部，sldh2被实现
成是一个独立的沙盒。这样把他解压到/d/sldh2中就可以运转了，不用修改
任何其他内容。

●起点

sldh2的起点是一个npc，用来报名和启/停大会的：

clone /d/sldh2/alx/core

她也同时维护着大会的心跳。她会把自己所在环境设成no_clean_up，防止自
己被销毁。因为对立阵营我选择了“仙界”和“魔道”，所以我借用了紫霞
仙子的经典疑问，不过描述却是林妹妹。


●目录结构

目录结构是借鉴xyj的目录，后面将分别介绍。之所以搞得这么复杂，是为了
设计一个可扩展的构架，除了sldh2，还可实现其他的内容，比如杀人游戏。
△feature    共享组件库
△cmds       战场专用命令
△skills     战场专用技能
△obj        战场物品
△alx        sldh2的主目录


●feature目录

这是提炼出来的被多个组件共享的库，值得注意有几个：
△buff       方便可靠的为目标增加/移除一个状态，很多东西都靠它实现
△util       实用工具库
△room       战场房间派生自它，他拦截了用户命令
△mapper     地图生成器，战场全图都由它生成
△nfs        门派实力统计和法术实力统计

●cmds目录

前面提到，room拦截了用户命令，先到这个目录来查找，然后在调用系统命
令。这样就可以增加新命令或替换系统命令，比如：
△kill       去掉了原始kill的所有限制，无参数的kill可消除所有叫杀
△remove     仅仅拦截remove all，防止某些玩家频繁穿脱装备刷屏
△perform    拦截用户pfm请求，先到skill目录查找，方便增加/替换技能
△cast       与perform类似
△exert      与perform类似
△buff       查看目标上的状态，比如真身，舞雪
△bian       替代系统的bian，避免和其他技能的冲突

●skills目录

为了适应战场我改良了部分skill：
△隐身       改成随时再次cast来取消，类似的还有舞雪，真身等
△奇门遁甲   扰民且变态，五庄观没它太弱，我实现了一个绿色污染的版本

此外，我还为boss级别的npc设计了一些有特色的技能：
△九屁神功   大话西游里齐天大圣出场时的那个风云变色的屁
△移形换影   大话西游里牛魔王妹妹的招牌技能，交换双方的肉身
△三昧真火2  西游记里那场壮观的火灾
△利爪       西游记玉鼠一爪抓死小和尚
这些计划成为战场里的剧情元素，但剧情部分还没完成


●obj目录

战场特有物品，目前没什么值得注意的东西。wiz/bb.c是投票箱。


●alx目录

sldh2的主目录，比较重要文件：
△config.h  各种参数的配置
△core      sldh2的起点，核心
△battle    战斗部分核心
△hair      救命毫毛，用于帮助低端玩家在战场生存
△map       该文件描述了战场的整个地图，配合mapper生成全部地图
△npc目录   剧情NPC(未完成)


●其他

△技能命中我采取了对应属性比加权平均和的方式，简洁防溢出无退化
△我用的OS是99年王文军周霖的MudOS v22pre11
△部分代码结构还不够清晰，npc剧情部分没完成
△代码分散在不同文件中，要搞清楚，可能要解除查找工具

